import{B as u,R as f,j as e,u as k,C as v}from"./index-DrxXdM3J.js";import{P as T}from"./PageHeader-nYE-d30j.js";import{u as S}from"./useQuery-0NeuAYYg.js";import{i as h}from"./auth.service-DWmYLrhL.js";import{u as D}from"./index.esm-BfdJ-TC4.js";import{M as F}from"./index-CX7Zy_2Y.js";import{u as R}from"./use-dialog.hook-DyhKwMzE.js";import{B as C}from"./button-lqzCSPkk.js";import{R as M,a as I,b as L}from"./PlusCircleOutlined-KC_1aj1j.js";import{R as A}from"./EyeOutlined-ClNivpRr.js";import"./context-BYXV2osY.js";const y={createAnnouncement:async function(t){return await h.post("admin/announcements",t,{headers:{"Content-Type":"multipart/form-data"}}).then(n=>(u.success("Announcement successfully created"),n.data.data)).catch(n=>{console.error(n)})},getAnnouncementsList:async function(){return await h.get("/admin/announcements").then(t=>t.data.data).catch(t=>{console.error(t)})},updateAnnouncement:async function(t){return await h.patch("admin/announcements",t,{headers:{"Content-Type":"multipart/form-data"}}).then(n=>(u.success("Announcement successfully updated"),n.data.data)).catch(n=>{u.error("Failed to update announcement"),console.error(n)})},deleteAnnouncement:async function(t){return await h.delete(`admin/announcements/${t}`).then(n=>(u.success("Announcement successfully deleted"),n.data.data)).catch(n=>{u.error("Failed to delete announcement"),console.error(n)})}},q=t=>{const[n,l]=f.useState(!1),{setValue:c,handleSubmit:p,register:o,reset:x,formState:{errors:d}}=D(),g=p(async s=>{if(l(!0),console.log(s.image[0]),t.formType==="add"){const r=new FormData;r.append("title",s.title),r.append("message",s.message),r.append("image",j),await y.createAnnouncement(r),x(),t.refetch()}else{const r=new FormData;r.append("title",s.title),r.append("message",s.message),r.append("image",s.image[0]),await y.updateAnnouncement(r),x(),t.handleClose()}l(!1),t.handleClose()}),[i,m]=f.useState(null),[j,a]=f.useState(null),N=s=>{var b;const r=(b=s.target.files)==null?void 0:b[0];if(r){const w=new FileReader;w.onloadend=()=>{m(w.result)},w.readAsDataURL(r),a(r)}else m(null)};return f.useEffect(()=>{if(console.log(t.formType),t.data){for(const[s,r]of Object.entries(t.data))c(s,r);m(t.data.banner_img)}},[t.formType,t.data,c]),e.jsx(F,{loading:n,onClose:t.handleClose,open:t.show,title:t.formType==="add"?"Create Announcement":"Update Announcement",onCancel:t.handleClose,...t.formType!=="view"?{okText:"Submit",onOk:g}:{footer:null},children:e.jsxs("form",{className:"flex flex-col gap-2",onSubmit:g,children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("p",{className:"text-sm",children:[t.formType==="add"&&e.jsx("span",{className:"text-red-600 mr-1",children:"*"}),"Title"]}),e.jsx("input",{className:d.title?"border border-red-400":"appearance-none block w-full  text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500",...o("title",{required:!0}),type:"text",...t.formType==="view"?{disabled:!0}:{},required:!0})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("p",{className:"text-sm",children:[t.formType==="add"&&e.jsx("span",{className:"text-red-600 mr-1",children:"*"})," Description"]}),e.jsx("input",{type:"text",...t.formType==="view"?{disabled:!0}:{},...o("message"),required:!0,className:d.message?"border border-red-400":"appearance-none block w-full  text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500"})]}),e.jsx("h1",{children:"Upload File"}),e.jsxs("div",{className:"flex items-center justify-center w-full",children:[e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-gray-800 dark:bg-gray-700 hover:bg-gray-100 dark:border-gray-600 dark:hover:border-gray-500",children:[i?e.jsx("img",{src:i,alt:"Selected Image",className:"w-full h-full object-cover"}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx("svg",{className:"w-8 h-8 mb-4 text-gray-500 dark:text-gray-400","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 16",children:e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"})}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-semibold",children:"Click to upload"})," or drag and drop"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"SVG, PNG, JPG or GIF (MAX. 800x400px)"})]})}),e.jsx("input",{...o("image"),type:"file",className:"hidden",id:"imageSelect",onChange:N,...t.formType==="view"?{disabled:!0}:{}})]}),d.image?e.jsx("small",{className:"text-xs text-red-400",children:"Image is required"}):null]})]})})},K=()=>{const t=k.getState().GET_AUTH_DATA().user.user_role.name,{data:n,refetch:l}=S({queryKey:["data-announcements-list"],queryFn:async()=>await y.getAnnouncementsList()}),[c,p]=f.useState({show:!1,selectedData:void 0}),o=a=>{p(a)},x=a=>{o({show:!0,selectedData:a,formType:"update"})},d=a=>{o({show:!0,selectedData:a,formType:"view"})},{showConfirm:g,closeConfirm:i,DialogComponent:m}=R(),j=a=>{g({open:!0,title:"Confirm Deletion",description:"Are you sure you want to delete this record?",type:"danger",onConfirm:async()=>{await y.deleteAnnouncement(a),l(),i()},onCancel:()=>{i()}})};return e.jsxs(e.Fragment,{children:[m,e.jsx(T,{title:"Manage Announcement"}),e.jsx(q,{show:c.show,formType:c.formType,data:c.selectedData,refetch:l,handleClose:()=>o({show:!1,selectedData:void 0})}),e.jsx("div",{className:"flex flex-row max-md:flex-col justify-end gap-3 w-full mb-4",children:e.jsxs(e.Fragment,{children:[t==="superadmin"&&e.jsx(C,{type:"primary",className:"bg-orange-500",icon:e.jsx(M,{}),onClick:()=>o({show:!0}),children:"Add Announcement"}),e.jsx(C,{className:"h-[35px] max-md:!w-full px-3 rounded bg-gray-200 border border-gray-300 text-gray-800 text-sm",type:"primary",onClick:()=>l(),children:"Refresh list"})]})}),e.jsx("div",{className:"over-flow-auto h-[80vh] md:overflow-auto sm:overflow-auto",children:e.jsx("div",{className:"flex flex-wrap xl:gap-9 md:gap-4 justify-center gap-3 over-flow-auto  md:overflow-auto sm:overflow-auto",children:n&&n.map(a=>e.jsx(v,{style:{width:350},cover:e.jsx("img",{alt:"example",className:"h-40 object-cover",src:a.banner_img}),...t==="superadmin"&&{actions:[e.jsx(A,{onClick:()=>d(a)}),e.jsx(I,{onClick:()=>x(a)}),e.jsx(L,{onClick:()=>j(a.id)})]},...t==="teacher"||t==="student"?{actions:[e.jsx(A,{onClick:()=>d(a)})]}:null,children:e.jsx(v.Meta,{title:a.title,description:a.message})},a.id))})})]})};export{K as default};
