import{R as d,j as e,Y as w,V as r}from"./index-CTNc0h0S.js";import{u as _}from"./index.esm-vrORIAiX.js";import{M as y}from"./index-BGGl8dva.js";import{U as N}from"./user.service-Czq_A2SJ.js";import{u as v}from"./useQuery-DDZH6T-k.js";import{S as p,F as C}from"./Table-BMFh8mbt.js";import{P as k}from"./PageHeader-Ct09w8tj.js";import{i}from"./auth.service-Bh8YR8GJ.js";import{B as g}from"./button-hEMNqgW3.js";import"./context-l6_uxjmp.js";import"./index-0_C_ea6x.js";import"./useIcons-n8VDLauN.js";import"./index-CsVpOp7q.js";import"./index-B3SLH_HF.js";import"./EyeOutlined-DzsZdUem.js";const F=t=>{const[s,a]=d.useState(!1),{setValue:l,handleSubmit:o,register:m,reset:x,formState:{errors:u}}=_(),f=w,h=o(async n=>{console.log("submit",n)});return e.jsx(e.Fragment,{children:e.jsx(y,{loading:s,title:"Create Section",open:t.show,onCancel:t.handleClose,onOk:h,okText:"Create",children:e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Grade Level"}),e.jsxs("select",{className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm",...m("grade_level",{required:!0}),children:[e.jsx("option",{value:"",children:"Select Grade Level"}),f.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))]}),u.grade_level&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:"This field is required"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Section Name"}),e.jsx("input",{...m("section_name",{required:!0}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm"}),u.section_name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:"This field is required"})]})]})})})},M=t=>{const{data:s}=v({queryKey:["data-user-list"],queryFn:async()=>await N.getUsersList()}),a=[],l=o=>{console.log(`selected ${o}`)};return d.useEffect(()=>{console.log(s),s&&s.data.filter(o=>o.userRole.id===3).map(o=>({label:o.first_name+" "+o.last_name,value:o.id}))},[s]),e.jsx(e.Fragment,{children:e.jsx(y,{open:t.show,onClose:t.handleClose,title:"Edit Section",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Adviser"}),e.jsx(p,{placeholder:"Select Adviser",className:"w-full"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Students"}),e.jsx(p,{mode:"multiple",allowClear:!0,style:{width:"100%"},placeholder:"Please select Students to be added in Section",defaultValue:["a10","c12"],onChange:l,options:a})]})]})})})},E={getSections:async function(){return await i.get("admin/roles").then(t=>{if(t.data)return t.data.filter(s=>s.name!=="super-admin")}).catch(t=>{console.error(t),r.error("Failed to fetch user roles")})},getUsersList:async function(){return await i.get("admin/accounts").then(t=>t.data.data).catch(t=>{console.error(t),r.error("Failed to fetch users list")})},deleteUser:async function(t){return await i.delete("/admin/accounts/"+t).then(s=>(r.info("Account successfully deleted/removed"),s.data)).catch(s=>{console.log(s),r.error("Failed to delete/remove user account")})},createUser:async function(t,s){return t.userRoleId=+t.userRoleId,t.departmentId=t.departmentId?+t.departmentId:null,await i.post("/admin/accounts",t).then(a=>(r.success("Account successfully created"),s(),a.data)).catch(a=>{var l;((l=a.response)==null?void 0:l.status)===400?r.error("E-mail/Name already associated with another account"):r.error("Failed to add user account")})},updateUser:async function(t,s){return await i.patch("/admin/accounts/"+t,{...s,user_rple_id:+s.user_role_id}).then(a=>(r.info("Account successfully updated"),a.data)).catch(a=>{console.log(a),r.error("Failed to update user account")})},getUserRolesList:async function(){return await i.get("admin/roles").then(t=>t.data.data).catch(t=>{console.error(t),r.error("Failed to fetch user roles")})}},O=()=>{const{data:t,isFetching:s,refetch:a}=v({queryKey:["data-section-list"],queryFn:async()=>await E.getUsersList()}),[l,o]=d.useState({show:!1,selectedData:void 0}),[m,x]=d.useState(!1),u=c=>{o(c)},[f,h]=d.useState({show:!1,selectedData:void 0}),n=c=>{h(c)},b=c=>{n({show:!0,selectedData:void 0})},j=[{title:"Section Name",dataIndex:"section_name",key:"section_name"},{title:"Grade Level",dataIndex:"grade_level",key:"grade_level"},{title:"Actions",key:"action-options",render:c=>e.jsx("div",{className:"flex flex-row gap-2",children:e.jsx(g,{type:"primary",size:"small",onClick:()=>b(),children:"Edit"})})}],S=[{key:"1",section_name:"Section 1",grade_level:"Grade 7"},{key:"2",section_name:"Section 2",grade_level:"Grade 8"},{key:"3",section_name:"Section 3",grade_level:"Grade 9"}];return d.useEffect(()=>{t?t.filter(c=>+c.user_role==2).length>0&&x(!0):x(!1)},[t]),e.jsxs("div",{children:[e.jsx(F,{show:l.show,formType:l.formType,handleClose:()=>u({show:!1,selectedData:void 0}),disableDC:m,refetch:a}),e.jsx(M,{show:f.show,formType:f.formType,handleClose:()=>n({show:!1,selectedData:void 0}),disableDC:m,refetch:a}),e.jsx(k,{title:"Manage Sections"}),e.jsx("div",{className:"flex mb-4 justify-end",children:e.jsx(g,{type:"primary",onClick:()=>u({show:!0,formType:"add"}),children:"Create Section"})}),e.jsx("div",{className:"min:h-[400px] bg-white border-t-2 border-gray-100",children:e.jsx(C,{columns:j,dataSource:S,loading:s,pagination:!1})})]})};export{O as default};
